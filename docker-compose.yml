version: '3.7'
services:
  client:
    build:
      context: .
      dockerfile: ./client/Dockerfile
    volumes:
      - ./client/src/:/client/src/
      - ./client/public/:/client/public/
      - ./client/package.json:/client/package.json
      - ./client/yarn.lock:/client/yarn.lock
      - ./client/tsconfig.json:/client/tsconfig.json
      - ./client/.eslintrc.js:/client/.eslintrc.js
      - ./client/.env:/client/.env
    ports:
      - 3000:3000
    depends_on:
      - server
    environment:
      - CHOKIDAR_USEPOLLING=true
      - HTTPS=true
      - SSL_KEY_FILE=client.key
      - SSL_CRT_FILE=client.crt
    networks:
      checker_game:
    tty: true
  server:
    build:
      context: .
      dockerfile: ./server/Dockerfile
    volumes:
      - ./server/config/:/var/www/html/config/
      - ./server/src/:/var/www/html/src/
      - ./server/.env:/var/www/html/.env
      - ./server/composer.json:/var/www/html/composer.json
      - ./server/composer.lock:/var/www/html/composer.lock
      - ./server/symfony.lock:/var/www/html/symfony.lock
    environment:
      - CHOKIDAR_USEPOLLING=true
      - MYSQL_HOST=mysql
    ports:
      - 80:80
      - 443:443
    depends_on:
      - mysql
    links:
      - mysql
    networks:
      checker_game:

  mysql:
    build:
      context: .
      dockerfile: ./database/Dockerfile
    restart: always
    command: ["--default-authentication-plugin=mysql_native_password"]
    ports:
      - 3306:3306
    env_file:
      - ./database/.env
    networks:
      checker_game:

networks:
  checker_game:
